<!DOCTYPE html><html>
        <head>
        <title>WCM2021</title>
        <meta charset="utf-8">
<meta property="head" content="H2">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link href="https://fonts.googleapis.com/css?family=Quicksand:300,400,500,700,900" rel="stylesheet">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/fonts/icomoon/style.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/bootstrap.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/magnific-popup.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/jquery-ui.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/owl.carousel.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/owl.theme.default.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/bootstrap-datepicker.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/fonts/flaticon/font/flaticon.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/aos.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/style.css">
        <link rel="shortcut icon" href="./../cmsimde/static/favicons.png">
        
        <style type='text/css'>
            .site-section {
            background-color: #FFFF;
            padding: 40px 40px;
            }
            body > div > div.dropdown.open {
                display: block;
            }
        </style>
    
        <!-- <script src="./../cmsimde/static/jquery.js"></script> -->
        <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
        <script src="../cmsimde/static/chimper/js/jquery-3.3.1.min.js"></script>
        <link rel="stylesheet" href="./../cmsimde/static/tipuesearch/css/normalize.min.css">
        <script src="./../cmsimde/static/tipuesearch/tipuesearch_set.js"></script>
        <script src="tipuesearch_content.js"></script>
        <link rel="stylesheet" href="./../cmsimde/static/tipuesearch/css/tipuesearch.css">
        <script src="./../cmsimde/static/tipuesearch/tipuesearch.js"></script>
        <script>
            /* original tipuesearch
            $(document).ready(function() {
                 $('#tipue_search_input').tipuesearch();
            });
            */
            // customed doSearch
            function doSearch() {
                $('#tipue_search_input').tipuesearch({
                    newWindow: true, 
                    minimumLength: 2,
                    wholeWords: false, // for search 中文
                });
            }
            $(document).ready(doSearch);
        </script>
        
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shCore.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushBash.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushDiff.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushJScript.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushJava.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPython.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushSql.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushHaxe.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushXml.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPhp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushLua.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCpp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCss.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCSharp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushDart.js"></script>
<link type="text/css" rel="stylesheet" href="./../cmsimde/static/syntaxhighlighter/css/shCoreDefault.css"/>
<script type="text/javascript">SyntaxHighlighter.all();</script>
<!-- 暫時不用
<script src="./../cmsimde/static/fengari-web.js"></script>
<script type="text/javascript" src="./../cmsimde/static/Cango-13v08-min.js"></script>
<script type="text/javascript" src="./../cmsimde/static/CangoAxes-4v01-min.js"></script>
<script type="text/javascript" src="./../cmsimde/static/gearUtils-05.js"></script>
-->
<!-- for Brython 暫時不用
<script src="https://scrum-3.github.io/web/brython/brython.js"></script>
<script src="https://scrum-3.github.io/web/brython/brython_stdlib.js"></script>
-->
<style>
img.add_border {
    border: 3px solid blue;
}
</style>

</head>
<body>
<div class='container'><nav>
        
    <div class="site-wrap">

    <div class="site-mobile-menu">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close mt-3">
          <span class="icon-close2 js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div>
    
            <header class="site-navbar py-4 bg-white" role="banner">
              <div class="container-fluid">
                <div class="row align-items-center">
                <h1>WCM2021 網際內容管理</h1>
                <div class="pl-4">
                    <form>
                    <input type="text" placeholder="Search" name="q" id="tipue_search_input" pattern=".{2,}" title="At least 2 characters" required>
                    </form>
                </div>
                  <!-- <div class="col-11 col-xl-2">
                    <h1 class="mb-0 site-logo"><a href="index.html" class="text-black h2 mb-0">WCM2021 網際內容管理</a></h1> 
                  </div>
                  -->
                  <div class="col-12 col-md-10 d-none d-xl-block">
                    <nav class="site-navigation position-relative text-right" role="navigation">
    <ul class='site-menu js-clone-nav mr-auto d-none d-lg-block'>
                        <li class="active has-children"><a href="index.html">Home</a>
                        <ul class="dropdown">
                            <li><a href="sitemap.html">Site Map</a></li>
                            <li><a href="./../reveal/index.html">reveal</a></li>
                            <li><a href="./../blog/index.html">blog</a></li>
                        </ul>
                      </li>
                     <li class='has-children'><a href='About.html'>About</a><ul class='dropdown'><li><a href='三道牆理論.html'>三道牆理論</a><li><a href='機械工程師.html'>機械工程師</a><li><a href='Programming.html'>Programming</a><li><a href='Heroku.html'>Heroku</a></li></ul><li class='has-children'><a href='Topics.html'>Topics</a><ul class='dropdown'><li class='has-children'><a href='W1-W2.html'>W1-W2</a><ul class='dropdown'><li><a href='Hybrid 系統.html'>Hybrid 系統</a><li><a href='網頁除錯.html'>網頁除錯</a></li></ul><li class='has-children'><a href='W4.html'>W4</a><ul class='dropdown'><li><a href='W4 教學.html'>W4 教學</a></li></ul><li class='has-children'><a href='W5.html'>W5</a><ul class='dropdown'><li><a href='W5 教學影片.html'>W5 教學影片</a><li><a href='創新教育.html'>創新教育</a><li><a href='網際程式開發.html'>網際程式開發</a><li><a href='開放教科書.html'>開放教科書</a></li></ul><li class='has-children'><a href='W6.html'>W6</a><ul class='dropdown'><li><a href='Heroku-實作.html'>Heroku-實作</a></li></ul><li class='has-children'><a href='W7.html'>W7</a><ul class='dropdown'><li><a href='SSH 設定.html'>SSH 設定</a></li></ul><li class='has-children'><a href='W8.html'>W8</a><ul class='dropdown'><li><a href='期中專案.html'>期中專案</a><li><a href='RoboDK.html'>RoboDK</a><li><a href='Robotics.html'>Robotics</a></li></ul><li><a href='W9.html'>W9</a><li class='has-children'><a href='W10.html'>W10</a><ul class='dropdown'><li><a href='Proxy Server.html'>Proxy Server</a><li><a href='網際資料庫程式.html'>網際資料庫程式</a><li><a href='網際機械設計程式.html'>網際機械設計程式</a><li><a href='網際 Robot 程式.html'>網際 Robot 程式</a><li><a href='CMSiMDE Debug 程式.html'>CMSiMDE Debug 程式</a></li></ul><li><a href='分組專題.html'>分組專題</a><li><a href='Topic 0.html'>Topic 0</a><li><a href='Topic 1.html'>Topic 1</a><li><a href='輔助工具.html'>輔助工具</a></li></ul><li class='has-children'><a href='Database.html'>Database</a><ul class='dropdown'><li><a href='peewee.html'>peewee</a><li><a href='SQLite.html'>SQLite</a><li><a href='PostgreSQL.html'>PostgreSQL</a><li><a href='MySQL.html'>MySQL</a><li><a href='Pygrouf.html'>Pygrouf</a></li></ul><li><a href='WSL.html'>WSL</a><li class='has-children'><a href='Projects.html'>Projects</a><ul class='dropdown'><li><a href='Delta Printer.html'>Delta Printer</a><li><a href='CMSiMDE.html'>CMSiMDE</a><li><a href='Fossil scm.html'>Fossil scm</a><li><a href='CDiMDE.html'>CDiMDE</a><li><a href='Discourse.html'>Discourse</a><li class='has-children'><a href='PPL.html'>PPL</a><ul class='dropdown'><li><a href='Machine Learning.html'>Machine Learning</a></li>
                      </ul>
                </nav>
              </div>
              <div class="d-inline-block d-xl-none ml-md-0 mr-auto py-3" style="position: relative; top: 3px;"><a href="#" class="site-menu-toggle js-menu-toggle text-black"><span class="icon-menu h3"></span></a></div>
              </div>

            </div>
          </div>
          
        </header>
    <div id="tipue_search_content">peewee << <a href='peewee.html'>Previous</a> <a href='PostgreSQL.html'>Next</a> >> PostgreSQL<br /><h1>SQLite</h1>
<p>SQLite GUI 工具:</p>
<p style="padding-left: 30px;"><a href="https://sqlitebrowser.org/dl/">https://sqlitebrowser.org/dl/</a> (download)<br/><br/><a href="https://github.com/sqlitebrowser/sqlitebrowser">https://github.com/sqlitebrowser/sqlitebrowser </a>(source code)</p>
<h4>利用 <a href="https://www.sqlite.org">SQLite</a> 儲存 Flask 網際程式的檔案:</h4>
<p style="padding-left: 30px;"><a href="https://github.com/mdecourse/nfumde">https://github.com/mdecourse/nfumde</a> (將各實驗室排課時間表存入資料庫)</p>
<p style="padding-left: 30px;"><a href="http://nfumde.herokuapp.com/table">http://nfumde.herokuapp.com/table</a> (heroku5 AT mde)</p>
<p style="padding-left: 30px;"><a href="https://github.com/mdecourse/nfulist">https://github.com/mdecourse/nfulist</a> (將查詢過的修課成員名單存入資料庫)</p>
<p style="padding-left: 30px;"><a href="https://github.com/mdecourse/scissor-rock-paper2">https://github.com/mdecourse/scissor-rock-paper2</a> (將每一場猜拳結果存入資料庫)</p>
<p style="padding-left: 30px;"><a href="https://github.com/mdecourse/lookupdict">https://github.com/mdecourse/lookupdict</a> </p>
<p style="padding-left: 30px;"><a href="https://github.com/mdecourse/wcms-scrum1">https://github.com/mdecourse/wcms-scrum1</a></p>
<h4 style="padding-left: 30px;">Google Oauth2 登入 in Python Flask:</h4>
<p style="padding-left: 60px;"><a href="https://myapollo.com.tw/zh-tw/integrating-google-sign-in-into-flask-app/">https://myapollo.com.tw/zh-tw/integrating-google-sign-in-into-flask-app/</a></p>
<p style="padding-left: 60px;"><a href="https://www.maxlist.xyz/2019/06/29/flask-google-login/">https://www.maxlist.xyz/2019/06/29/flask-google-login/</a></p>
<p>以 <a href="https://www.msys2.org/">Msys2</a> 自行編譯 <a href="https://sqlite.org/src/doc/trunk/README.md">SQLite 原始碼</a>.</p>
<p>利用 Python 批次建立 Fossil SCM 使用者帳號：</p>
<p style="padding-left: 30px;"><a href="http://lab.kmol.info/blog/Year-2017-Conclusion.html">http://lab.kmol.info/blog/Year-2017-Conclusion.html</a> (寄信程式必須改為 Gmail API)</p>
<h4>實習目的:</h4>
<p style="padding-left: 30px;">利用較簡單的 SQLite 練習 SQL 語法</p>
<p style="padding-left: 30px;">Python 透過 <a href="https://github.com/coleifer/peewee">peewee</a> <a href="https://en.wikipedia.org/wiki/Object%E2%80%93relational_mapping">ORM</a> 連接資料庫</p>
<h4>建立資料庫:</h4>
<p><a href="./../downloads/w1_create_db.py">w1_create_db.py</a></p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">import os
# sqlite3 模組為 Python3 內建
import sqlite3
 

# 為了讓程式能夠同時在 Leo Editor 與 SciTE 中執行列印
# 特別建立 leoprint 函式
# *args 表示 leoprint 可以接受任意數量的輸入變數
def leoprint(*args):
    try:
        g.es(*args)
    except:
        print(*args)
 
# 資料庫檔案將與程式放在同一目錄
data_dir = "./"
 
class Init(object):
    def __init__(self):
        # 資料庫選用
        # 內建使用 sqlite3                
        ormdb = "sqlite"
        #ormdb = "mysql"
        #ormdb = "postgresql"
     
        if ormdb == "sqlite":
            # 資料庫使用 SQLite
            # ORM 只能建立資料表, 無法直接建立資料庫
            # 因此 MySQL 資料庫採 pymysql 建立
            # SQLite 資料庫採 sqlite3 建立
            # PostgreSQL 資料庫採 psycopg2 建立
            # 也可以使用 peewee 建立資料表格
            try:
                conn = sqlite3.connect(data_dir+"course.db")
                cur = conn.cursor()
                # 建立資料表
                cur.execute("CREATE TABLE IF NOT EXISTS course( \
                        id INTEGER PRIMARY KEY AUTOINCREMENT, \
                        semester TEXT, \
                        classroomno TEXT, \
                        week TEXT, \
                        session TEXT, \
                        content TEXT, \
                        memo TEXT);")
                cur.close()
                conn.close()
            except:
                leoprint("can not create db and table")
     
# 建立案例
init = Init()
leoprint("done")
</pre>
<h4>將從教務主機取回的電腦輔助設計室排課資料寫入上述所建立的 SQLite 資料庫中:</h4>
<p><a href="./../downloads/w1_classroom_local_db.py">w1_classroom_local_db.py</a></p>
<p>假如 Proxy 設定需要帳號與密碼, 則必須透過外部讀取的方式取得設定, 儘量不要直接將帳號密碼放在倉儲或網站中.</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">with open("./../proxy_setup.txt") as fh:
    data = fh.readline()
#print(data)
proxy = data</pre>
<p>proxy_setup.txt 的內容則為: http://代理主機帳號:代理主機密碼@[2001:代理主機 IP 位址]:3128</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false"># 使用 peewee ORM
from peewee import SqliteDatabase, Model, CharField, TextField, IntegerField, MySQLDatabase
import requests
import bs4
# for os.environ and os.system
import os
# for geting html file path
import pathlib
import re

# 為了讓程式能夠同時在 Leo Editor 與 SciTE 中執行列印
# 特別建立 leoprint 函式
# *args 表示 leoprint 可以接受任意數量的輸入變數
def leoprint(*args):
    try:
        g.es(*args)
    except:
        print(*args)
        
ormdb = "sqlite"

if ormdb == "sqlite":
    # 針對 sqlite3 指定資料庫檔案, , check_same_thread 設為 False, 表示資料庫可以跨執行緒
    db = SqliteDatabase("./course.db", check_same_thread=False)
    db.connection()

# 在此建立資料表欄位
# 因為 peewee class Meta 的 legacy_table_names=True, 因此當 class 名稱為 Course
# peewee 會自動假設資料表的名稱為 course.db
class Course(Model):
    # peewee 內定 id 為 PrimaryKey
    #id = PrimaryKey()
    semester = CharField()
    classroomno = CharField()
    week = CharField()
    session = CharField()
    content = CharField()
    memo = TextField()

    class Meta:
        database = db # This model uses the ./+"course.db" database.   

'''
# 在 Mac 執行不需要設定  proxy
# for pythn 3.9
proxy = 'http://[2001:288:6004:17::53]:3128'

os.environ['http_proxy'] = proxy 
os.environ['HTTP_PROXY'] = proxy
os.environ['https_proxy'] = proxy
os.environ['HTTPS_PROXY'] = proxy
'''
'''
url:  'jclassroom_ajax.php',
data: { pselyr: pselyr, pselclssroom: pselclssroom },
'''
semester = '1092'
classroomno = 'BGA0810'
column = True

if semester == None:
    semester = '1092'
if classroomno == None:
    # BGA0810 電腦輔助設計室
    classroomno = 'BGA0810'
    
headers = {'X-Requested-With': 'XMLHttpRequest'}

url = 'https://qry.nfu.edu.tw/jclassroom_ajax.php'
post_var = {'pselyr': semester, 'pselclssroom': classroomno}

result = requests.post(url, data = post_var, headers = headers)

soup = bs4.BeautifulSoup(result.content, 'lxml')

# 先除掉所有 anchor
for a in soup.findAll('a'):
    # bs3 語法
    #a.replaceWithChildren()
    # bs4 語法, 將標註與內容拆開
    a.unwrap()

# 根據輸出設定, 取出 class='tbcls' 的 table 資料
table = soup.find('table', {'class': 'tbcls'})

# 以下要準備能夠輸入資料庫的排課時段資料 #########################
tds = [row.findAll('td') for row in table.findAll('tr')]
#leoprint(tds)
count = 0
row = 0
results = {}
for td in tds:
    row = row + 1
    for i in range(len(td)):
        if i != 0 and td[i].text != "\xa0":
            leoprint("星期"+str(i), "第"+str(row-2) + "節-", re.sub('&lt;[^&lt;]+?&gt;', '', td[i].text))
            count = count + 1
            #######
            #semester
            #classroomno
            week = str(i)
            session = str(row-2)
            content = re.sub('&lt;[^&lt;]+?&gt;', '', td[i].text)
            memo = ""
            data = Course.create(semester=semester, classroomno=classroomno, week=week, session=session, content=content, memo=memo)
            data.save()
    #leoprint("***************")
leoprint("total:" + str(count))
# 以上已經取得能夠輸入資料庫的排課時段資料 ######################

# ########## 以下程式碼用來計算排課節數 ###########################
# 以下取出 td 標註資料
table_data = [i.text for i in table.find_all('td')]
#leoprint(table_data)
timeTable = []
# 去除非排課欄位資料內容
for i in table_data:
    if not "虎尾科技" in i and not "節" in i and not "\xa0" in i:
        timeTable.append(i)
#leoprint(len(timeTable))
totalNum = len(timeTable)
# ########## 以上程式碼用來計算排課節數 ##########################

# 重建 table, 設定邊線為 1 pixel
output = "總排課節數: " + str(totalNum) + "&lt;br /&gt;&lt;br /&gt;&lt;table border='1'&gt;"

for i in table.contents:
    # 利用 replace 復原  
    output += str(i).replace("&amp;nbsp", " ")
output += "&lt;/table&gt;"

#leoprint(output)
db.close()
leoprint("done")</pre>
<h4>對上述已經輸入排課資料的電腦輔助設計室資料庫進行查詢:</h4>
<p><a href="./../downloads/w1_classroom_local_select.py">w1_classroom_local_select.py</a></p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false"># 使用 peewee ORM
from peewee import SqliteDatabase, Model, CharField, TextField, IntegerField, MySQLDatabase
# for os.environ and os.system
import os

# 為了讓程式能夠同時在 Leo Editor 與 SciTE 中執行列印
# 特別建立 leoprint 函式
# *args 表示 leoprint 可以接受任意數量的輸入變數
def leoprint(*args):
    try:
        g.es(*args)
    except:
        print(*args)
        
ormdb = "sqlite"

if ormdb == "sqlite":
    # 針對 sqlite3 指定資料庫檔案
    db = SqliteDatabase("./course.db", check_same_thread=False)
    db.connection()

# 在此建立資料表欄位
class Course(Model):
    # peewee 內定 id 為 PrimaryKey
    #id = PrimaryKey()
    semester = CharField()
    classroomno = CharField()
    week = CharField()
    session = CharField()
    content = CharField()
    memo = TextField()

    class Meta:
        database = db # This model uses the ./+"course.db" database.   

# 對資料庫進行 select 查詢, 星期四電腦輔助設計室的排課內容, 依照排課節次由小到大排序
data = Course.select().where(Course.week=="4").order_by(Course.session)
# 關閉資料庫連線
db.close()
# 計算查詢結果總數
total_rows = data.count()
# 逐一列出各筆資料的排課內容
for i in range(total_rows):
    c = data[i]
    leoprint("第"+str(c.session)+"節:", c.content)</pre>
<p></p><br />peewee << <a href='peewee.html'>Previous</a> <a href='PostgreSQL.html'>Next</a> >> PostgreSQL</div>
        
    <!-- footer -->
      <div class="container">
        <div class="row pt-3 mx-auto">
            <p>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank" >Colorlib</a>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            </p>
        </div>
      </div>
    <!-- for footer -->
    
        </div> <!-- for site wrap -->
            <!-- <script src="../cmsimde/static/chimper/js/jquery-3.3.1.min.js"></script> -->
            <script src="../cmsimde/static/chimper/js/jquery-migrate-3.0.1.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery-ui.js"></script>
            <script src="../cmsimde/static/chimper/js/popper.min.js"></script>
            <script src="../cmsimde/static/chimper/js/bootstrap.min.js"></script>
            <script src="../cmsimde/static/chimper/js/owl.carousel.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.stellar.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.countdown.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.magnific-popup.min.js"></script>
            <script src="../cmsimde/static/chimper/js/bootstrap-datepicker.min.js"></script>
            <script src="../cmsimde/static/chimper/js/aos.js"></script>
            <!--
            <script src="../cmsimde/static/chimper/js/typed.js"></script>
                    <script>
                    var typed = new Typed('.typed-words', {
                    strings: ["Web Apps"," WordPress"," Mobile Apps"],
                    typeSpeed: 80,
                    backSpeed: 80,
                    backDelay: 4000,
                    startDelay: 1000,
                    loop: true,
                    showCursor: true
                    });
                    </script>
            -->
            <script src="../cmsimde/static/chimper/js/main.js"></script>
        
<!-- 啟用 LaTeX equations 編輯 -->
  <!-- <script>
  MathJax = {
    tex: {inlineMath: [['$', '$'], ['\(', '\)']]}
  };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>-->
    </body></html>
        